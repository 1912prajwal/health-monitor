<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESP32 Health Monitor - Live Output</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    margin:0;
    background:linear-gradient(135deg,#0a0f24,#0e1b47,#062d4f);
    font-family: 'Segoe UI', sans-serif;
    color:white;
    text-align:center;
    padding:20px;
}

.header {
    margin:20px auto;
    max-width:900px;
}

h1{
    font-size:2.5rem;
    text-shadow:0 0 15px rgba(0,255,255,0.6);
    margin-bottom:10px;
}

.subtitle {
    color:#bcd4f6;
    font-size:1.1rem;
    margin-bottom:5px;
}

.status-bar {
    display:inline-block;
    background:rgba(0,255,0,0.2);
    padding:8px 20px;
    border-radius:20px;
    margin:10px 5px;
    border:1px solid rgba(0,255,0,0.4);
    animation:pulse 2s infinite;
}

.status-dot {
    display:inline-block;
    width:10px;
    height:10px;
    background:#00ff00;
    border-radius:50%;
    margin-right:8px;
    animation:blink 1s infinite;
}

@keyframes blink {
    0%, 100% { opacity:1; }
    50% { opacity:0.3; }
}

@keyframes pulse {
    0%, 100% { box-shadow:0 0 5px rgba(0,255,0,0.5); }
    50% { box-shadow:0 0 20px rgba(0,255,0,0.8); }
}

.connection-form {
    background:rgba(255,255,255,0.1);
    padding:20px;
    border-radius:15px;
    max-width:500px;
    margin:20px auto;
    backdrop-filter:blur(10px);
    border:1px solid rgba(0,255,255,0.3);
}

.connection-form input {
    width:calc(100% - 20px);
    padding:10px;
    margin:10px 0;
    border-radius:8px;
    border:1px solid rgba(0,255,255,0.4);
    background:rgba(0,0,0,0.3);
    color:white;
    font-size:1rem;
}

.connection-form button {
    background:linear-gradient(135deg, #00ffff, #0088ff);
    color:#0a0f24;
    padding:12px 30px;
    border:none;
    border-radius:25px;
    font-weight:bold;
    cursor:pointer;
    margin:10px 5px;
    font-size:1rem;
    transition:all 0.3s ease;
}

.connection-form button:hover {
    transform:translateY(-2px);
    box-shadow:0 5px 20px rgba(0,255,255,0.5);
}

.grid{
    margin:20px auto;
    max-width:1000px;
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
    gap:20px;
}

.card{
    padding:25px;
    background:rgba(255,255,255,0.08);
    border-radius:18px;
    backdrop-filter:blur(10px);
    box-shadow:0 0 18px rgba(0,255,255,0.3), inset 0 0 20px rgba(255,255,255,0.1);
    transition:0.3s;
    border:1px solid rgba(0,255,255,0.2);
    position:relative;
    overflow:hidden;
}

.card:hover{
    transform:translateY(-5px);
    box-shadow:0 0 30px rgba(0,255,255,0.7);
}

.card:before {
    content:'';
    position:absolute;
    top:-50%;
    left:-50%;
    width:200%;
    height:200%;
    background:linear-gradient(45deg, transparent, rgba(0,255,255,0.1), transparent);
    animation:shine 3s infinite;
}

@keyframes shine {
    0% { transform:rotate(0deg); }
    100% { transform:rotate(360deg); }
}

.icon {
    font-size:2.5rem;
    margin-bottom:10px;
}

.label{
    font-size:0.95rem;
    color:#bcd4f6;
    margin-bottom:10px;
}

.value{
    font-size:2.8rem;
    margin-top:10px;
    text-shadow:0 0 20px rgba(0,255,255,0.6);
    font-weight:bold;
}

.unit {
    font-size:1.2rem;
    color:#88ccff;
}

.raw-data {
    font-size:1rem;
    margin-top:5px;
    color:#9db2d4;
}

.warning {
    background:rgba(255,100,0,0.15);
    border:1px solid rgba(255,100,0,0.4);
}

.normal {
    background:rgba(0,255,0,0.1);
    border:1px solid rgba(0,255,0,0.3);
}

.error {
    background:rgba(255,0,0,0.15);
    border:1px solid rgba(255,0,0,0.4);
}

.mini-chart {
    height:60px;
    display:flex;
    align-items:flex-end;
    gap:2px;
    margin-top:10px;
    justify-content:center;
}

.bar {
    width:8px;
    background:linear-gradient(to top, #00ffff, #0088ff);
    border-radius:2px 2px 0 0;
    transition:height 0.3s ease;
}

.footer{
    margin-top:30px;
    color:#9db2d4;
    font-size:0.9rem;
}

.timestamp {
    background:rgba(0,0,0,0.3);
    padding:10px 20px;
    border-radius:10px;
    display:inline-block;
    margin:20px auto;
    color:#88ccff;
}

.hidden {
    display:none;
}

.note {
    background:rgba(255,255,0,0.1);
    border:1px solid rgba(255,255,0,0.3);
    padding:15px;
    border-radius:10px;
    margin:20px auto;
    max-width:600px;
    color:#ffff88;
}

@media (max-width: 768px) {
    h1 { font-size:1.8rem; }
    .value { font-size:2.2rem; }
}
</style>

</head>

<body>

<div class="header">
    <h1>üå°Ô∏è ESP32 Health Monitor Output</h1>
    <p class="subtitle">Real-time Data from Your Device</p>
    <div class="status-bar" id="statusBar">
        <span class="status-dot"></span>
        <span id="statusText">Enter ESP32 IP Address</span>
    </div>
    <div class="timestamp" id="timestamp">Not Connected</div>
</div>

<div class="connection-form" id="connectionForm">
    <h3 style="margin-top:0;">Connect to Your ESP32</h3>
    <input type="text" id="ipAddress" placeholder="Enter ESP32 IP (e.g., 192.168.1.100)" value="">
    <br>
    <button onclick="connectToESP32()">Connect</button>
    <button onclick="toggleDemo()">Use Demo Data</button>
    <div class="note" style="margin-top:15px; font-size:0.9rem;">
        üìå Find your ESP32 IP address in the Serial Monitor (115200 baud)
    </div>
</div>

<div id="dashboard" class="hidden">
    <div class="grid">

        <div class="card" id="bodyTempCard">
            <div class="icon">üå°Ô∏è</div>
            <div class="label">Body Temperature</div>
            <div class="value" id="bodyTemp">--<span class="unit">¬∞C</span></div>
            <div class="mini-chart" id="bodyTempChart"></div>
        </div>

        <div class="card">
            <div class="icon">üè†</div>
            <div class="label">Room Temperature</div>
            <div class="value" id="roomTemp">--<span class="unit">¬∞C</span></div>
            <div class="mini-chart" id="roomTempChart"></div>
        </div>

        <div class="card">
            <div class="icon">üíß</div>
            <div class="label">Humidity</div>
            <div class="value" id="humidity">--<span class="unit">%</span></div>
            <div class="mini-chart" id="humidityChart"></div>
        </div>

        <div class="card" id="bpmCard">
            <div class="icon">‚ù§Ô∏è</div>
            <div class="label">Heart Rate (BPM)</div>
            <div class="value" id="bpm">--<span class="unit">BPM</span></div>
            <div class="mini-chart" id="bpmChart"></div>
        </div>

        <div class="card" id="spo2Card">
            <div class="icon">üí®</div>
            <div class="label">Blood Oxygen (SpO‚ÇÇ)</div>
            <div class="value" id="spo2">--<span class="unit">%</span></div>
            <div class="mini-chart" id="spo2Chart"></div>
        </div>

        <div class="card">
            <div class="icon">üì°</div>
            <div class="label">Sensor Data (IR / RED)</div>
            <div class="value" style="font-size:1.3rem;">
                <div class="raw-data">IR: <span id="ir">--</span></div>
                <div class="raw-data">RED: <span id="red">--</span></div>
            </div>
        </div>

    </div>

    <button onclick="disconnect()" style="background:linear-gradient(135deg, #ff4444, #cc0000); color:white; padding:12px 30px; border:none; border-radius:25px; font-weight:bold; cursor:pointer; margin-top:20px;">
        Disconnect
    </button>
</div>

<p class="footer">üîÑ Data updates every second from your ESP32 device</p>

<script>
let updateInterval;
let espIP = '';
let demoMode = false;

// Initialize chart bars
function initChart(containerId, count = 15) {
    const container = document.getElementById(containerId);
    container.innerHTML = '';
    for (let i = 0; i < count; i++) {
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = '20px';
        container.appendChild(bar);
    }
}

// Update chart animation
function updateChart(containerId, newValue, maxValue) {
    const container = document.getElementById(containerId);
    const bars = container.querySelectorAll('.bar');
    
    for (let i = 0; i < bars.length - 1; i++) {
        bars[i].style.height = bars[i + 1].style.height;
    }
    
    const percentage = (newValue / maxValue) * 60;
    bars[bars.length - 1].style.height = Math.max(5, percentage) + 'px';
}

// Initialize all charts
function initAllCharts() {
    initChart('bodyTempChart', 20);
    initChart('roomTempChart', 20);
    initChart('humidityChart', 20);
    initChart('bpmChart', 20);
    initChart('spo2Chart', 20);
}

// Connect to ESP32
async function connectToESP32() {
    const ip = document.getElementById('ipAddress').value.trim();
    if (!ip) {
        alert('Please enter an IP address');
        return;
    }

    espIP = ip;
    demoMode = false;
    
    document.getElementById('connectionForm').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('statusText').textContent = 'Connected to ' + espIP;
    
    initAllCharts();
    
    if (updateInterval) clearInterval(updateInterval);
    updateInterval = setInterval(fetchData, 1000);
    fetchData();
}

// Toggle demo mode
function toggleDemo() {
    demoMode = true;
    espIP = 'demo';
    
    document.getElementById('connectionForm').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('statusText').textContent = 'Demo Mode (Simulated Data)';
    
    initAllCharts();
    
    if (updateInterval) clearInterval(updateInterval);
    updateInterval = setInterval(fetchData, 1000);
    fetchData();
}

// Fetch data from ESP32
async function fetchData() {
    if (demoMode) {
        // Demo data with realistic values
        const data = {
            bodyTemp: (36.2 + Math.random() * 1.2).toFixed(1),
            roomTemp: (24 + Math.random() * 3).toFixed(1),
            humidity: (58 + Math.random() * 10).toFixed(1),
            bpm: Math.floor(78 + Math.random() * 15),
            spo2: Math.floor(96 + Math.random() * 4),
            ir: Math.floor(85000 + Math.random() * 10000),
            red: Math.floor(44000 + Math.random() * 8000)
        };
        updateDisplay(data);
    } else {
        try {
            const response = await fetch(`http://${espIP}/data`);
            if (!response.ok) throw new Error('Connection failed');
            
            const data = await response.json();
            updateDisplay(data);
            
            document.getElementById('statusBar').style.background = 'rgba(0,255,0,0.2)';
            document.getElementById('statusBar').style.borderColor = 'rgba(0,255,0,0.4)';
        } catch (error) {
            console.error('Error fetching data:', error);
            document.getElementById('statusText').textContent = 'Connection Error - Retrying...';
            document.getElementById('statusBar').style.background = 'rgba(255,0,0,0.2)';
            document.getElementById('statusBar').style.borderColor = 'rgba(255,0,0,0.4)';
        }
    }
}

// Update display with data
function updateDisplay(data) {
    // Body Temperature
    document.getElementById('bodyTemp').innerHTML = data.bodyTemp + '<span class="unit">¬∞C</span>';
    updateChart('bodyTempChart', parseFloat(data.bodyTemp), 40);
    
    const bodyTempCard = document.getElementById('bodyTempCard');
    bodyTempCard.classList.remove('warning', 'normal', 'error');
    if (parseFloat(data.bodyTemp) > 37.5) {
        bodyTempCard.classList.add('warning');
    } else if (parseFloat(data.bodyTemp) < 35) {
        bodyTempCard.classList.add('error');
    } else {
        bodyTempCard.classList.add('normal');
    }

    // Room Temperature
    document.getElementById('roomTemp').innerHTML = data.roomTemp + '<span class="unit">¬∞C</span>';
    updateChart('roomTempChart', parseFloat(data.roomTemp), 40);

    // Humidity
    document.getElementById('humidity').innerHTML = data.humidity + '<span class="unit">%</span>';
    updateChart('humidityChart', parseFloat(data.humidity), 100);

    // Heart Rate
    const bpmValue = parseInt(data.bpm);
    if (bpmValue > 0) {
        document.getElementById('bpm').innerHTML = bpmValue + '<span class="unit">BPM</span>';
        updateChart('bpmChart', bpmValue, 120);
        
        const bpmCard = document.getElementById('bpmCard');
        bpmCard.classList.remove('warning', 'normal', 'error');
        if (bpmValue < 60 || bpmValue > 100) {
            bpmCard.classList.add('warning');
        } else {
            bpmCard.classList.add('normal');
        }
    } else {
        document.getElementById('bpm').innerHTML = 'No Finger<span class="unit"></span>';
    }

    // SpO2
    const spo2Value = parseInt(data.spo2);
    if (spo2Value > 0) {
        document.getElementById('spo2').innerHTML = spo2Value + '<span class="unit">%</span>';
        updateChart('spo2Chart', spo2Value, 100);
        
        const spo2Card = document.getElementById('spo2Card');
        spo2Card.classList.remove('warning', 'normal', 'error');
        if (spo2Value < 95) {
            spo2Card.classList.add('warning');
        } else {
            spo2Card.classList.add('normal');
        }
    } else {
        document.getElementById('spo2').innerHTML = 'No Finger<span class="unit"></span>';
    }

    // Raw sensor values
    document.getElementById('ir').textContent = data.ir;
    document.getElementById('red').textContent = data.red;

    // Update timestamp
    const now = new Date();
    const timeStr = now.toLocaleTimeString('en-US', { 
        hour12: true, 
        hour: '2-digit', 
        minute: '2-digit', 
        second: '2-digit' 
    });
    document.getElementById('timestamp').textContent = 'üïê Last Updated: ' + timeStr;
}

// Disconnect
function disconnect() {
    if (updateInterval) clearInterval(updateInterval);
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('connectionForm').classList.remove('hidden');
    document.getElementById('statusText').textContent = 'Enter ESP32 IP Address';
    document.getElementById('timestamp').textContent = 'Not Connected';
    espIP = '';
    demoMode = false;
}
</script>

</body>
</html>
